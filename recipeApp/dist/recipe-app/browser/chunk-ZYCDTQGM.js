import{C as h,g as m,i as a,l as s,o as u,oa as g,va as k,y as d}from"./chunk-XCSCIBJ5.js";var r=class{constructor(i,I,t,e){this.email=i,this.id=I,this._token=t,this._tokenExpirationDate=e}get token(){return!this._tokenExpirationDate||new Date>this._tokenExpirationDate?null:this._token}};var l={firebaseAPIKey:"AIzaSyAQXhfWddSIDzqlhyzCPiYO9MfBbHXLEyU"};var L=(()=>{let i=class i{constructor(t,e){this.http=t,this.router=e,this.user=new m(null),this.token=null}signup(t,e){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key="+l.firebaseAPIKey,{email:t,password:e,returnSecureToken:!0}).pipe(s(this.handleError),u(o=>{this.handleAuth(o.email,o.localId,o.idToken,+o.expiresIn)}))}handleAuth(t,e,o,c){let f=new Date(new Date().getTime()+c*1e3),p=new r(t,e,o,f);this.user.next(p),this.autoLogout(c*1e3),localStorage.setItem("userData",JSON.stringify(p))}autoLogin(){let t=JSON.parse(localStorage.getItem("userData"));if(!t)return;let e=new r(t.email,t.id,t._token,new Date(t._tokenExpirationDate));if(e.token){this.user.next(e);let o=new Date(t._tokenExpirationDate).getTime()-new Date().getTime();this.autoLogout(o)}}logOut(){this.user.next(null),this.router.navigate(["/auth"]),localStorage.removeItem("userData"),this.tokenExpirationTimer&&clearTimeout(this.tokenExpirationTimer),this.tokenExpirationTimer=null}autoLogout(t){console.log(t),this.tokenExpirationTimer=setTimeout(()=>{this.logOut()},t)}login(t,e){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyAQXhfWddSIDzqlhyzCPiYO9MfBbHXLEyU"+l.firebaseAPIKey,{email:t,password:e,returnSecureToken:!0}).pipe(s(this.handleError),u(o=>{this.handleAuth(o.email,o.localId,o.idToken,+o.expiresIn)}))}handleError(t){let e="unknown error";if(!t.error||!t.error.error)return a(e);switch(t.error.error.message){case"EMAIL_EXISTS":e="This email exists already";break;case"EMAIL_NOT_FOUND":case"INVALID_PASSWORD":case"INVALID_LOGIN_CREDENTIALS":e="You have entered an invalid username or password";break}return a(e)}};i.\u0275fac=function(e){return new(e||i)(h(g),h(k))},i.\u0275prov=d({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();export{L as a};
